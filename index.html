function parseGithubUrl(url) {
            try {
                const match = url.match(/github\.com\/([^/]+)\/([^/]+)(?:\/tree\/([^/]+))?(?:\/(.+))?/);
                if (!match) throw new Error('Invalid GitHub URL');

                return {
                    owner: match[1],
                    repo: match[2],
                    branch: match[3] || 'main',
                    path: match[4] || ''
                };
            } catch (error) {
                throw new Error('Invalid GitHub URL');
            }
        }

        function countFiles(contents) {
            return Array.isArray(contents) ? 
                contents.filter(item => item.type === 'file').length :
                (contents.type === 'file' ? 1 : 0);
        }

        async function processContents(contents, currentPath, options) {
            const items = Array.isArray(contents) ? contents : [contents];

            for (const item of items) {
                if (item.type === 'file') {
                    const response = await fetch(item.download_url);
                    const blob = await response.blob();
                    options.zip.file(currentPath + item.name, blob);
                    options.onProgress();
                } else if (item.type === 'dir') {
                    const response = await fetch(
                        `https://api.github.com/repos/${options.owner}/${options.repo}/contents/${item.path}?ref=${options.branch}`
                    );
                    const contents = await response.json();
                    await processContents(contents, currentPath + item.name + '/', options);
                }
            }
        }

        // Check for URL parameter on load
        window.addEventListener('load', () => {
            const params = new URLSearchParams(window.location.search);
            const urlParam = params.get('url');
            if (urlParam) {
                document.getElementById('url').value = urlParam;
                handleDownload();
            }
        });
